# ---------------------------------------------------------------------------
# NOTE: This service is deployed via Docker image (ECR), NOT managed runtime.
#
# The managed Python 3.11 runtime was attempted but fails to compile
# Rust-dependent packages (uvicorn[standard] → watchfiles, tiktoken).
# The Dockerfile (python:3.11.9-slim) handles these correctly because it has
# a full build environment.
#
# Deployment method:
#   1. Build: docker build -t stock-signal-advisor-api .
#   2. Push:  to Amazon ECR (see README for full push commands)
#   3. Create App Runner service → "Container registry" → ECR image URI
#
# This file is kept for reference only. App Runner reads it when using
# source-code deployment; it is NOT used by container-image deployment.
# ---------------------------------------------------------------------------

version: 1.0
runtime: python311

build:
  commands:
    build:
      - pip install --no-cache-dir -r requirements.txt

run:
  runtime-version: 3.11
  command: uvicorn app.main:app --host 0.0.0.0 --port 8000
  network:
    port: 8000
    env: PORT
  env:
    - name: ENVIRONMENT
      value: production
    - name: LOG_LEVEL
      value: INFO

# ---------------------------------------------------------------------------
# Secrets — configure these in the App Runner console under Environment Variables
# (never commit API keys to source control)
# ---------------------------------------------------------------------------
# LLM_PROVIDER          = openai
# LLM_MODEL             = gpt-4o-mini
# OPENAI_API_KEY        = sk-...
# VECTORSTORE_PROVIDER  = pinecone
# PINECONE_API_KEY      = ...
# PINECONE_INDEX_NAME   = stock-signal-advisor
# NEWS_API_KEY          = ...
# CACHE_TTL_SECONDS     = 3600
# CORS_ORIGINS          = ["https://main.XXXXXXXX.amplifyapp.com","http://localhost:3000"]
#
# Update CORS_ORIGINS with the actual Amplify app URL after Amplify is deployed.
